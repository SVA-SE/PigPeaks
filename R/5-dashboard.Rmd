---
title: "PigPeaks Dashboard"
output:
  flexdashboard::flex_dashboard:
    theme: simplex
    vertical_layout: scroll
    social: menu
    orientation: rows
    df_print: paged
  # logo: SVA_logo.png
---

<style type="text/css">

.chart-title {  /* chart_title  */
   font-size: 15px;
}
    
</style>

```{r message=FALSE, warning=FALSE}
library(flexdashboard)
library(plotly)
library(ggplot2)
library(stringr)


setwd('..') #do not run this line if running manually (instead of knitting)

source('Settings.r') 
source('R/Functions.r') 
source('R/Functions-plotting.r')
source('R/4-detection.R')
load('data/individual.sows.RData')

```

Gilts
====================================

```{r}

plots.gilts <- list()
  
for (i in which(indicators.categories=="gilts")) {
  #i=which(indicators.categories=="gilts")[1]
  
  if (isTRUE(indicators.sys[i])) {
    
    if (indicators.limits[i]=="limit.upp") {
      
      UCL.EWMA = TRUE
      LCL.EWMA = FALSE
      UCL.SHEW = TRUE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = FALSE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = FALSE
      
    }
    if (indicators.limits[i]=="both") {
      
      UCL.EWMA = TRUE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = TRUE
      
    }
    
    if (indicators.limits[i]=="limit.lw") {
      
      UCL.EWMA = FALSE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = TRUE
      alarms.EWMA.UPP = FALSE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = FALSE
      alarms.SHEW.LW = TRUE
      
    }
    
    if (indicators.type[i]=="W") {
      
      plots.gilts[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
                                     indicator.label = "indicator",
                                     show.window = weeks.to.show,
                                     index.dates = index.dates.week,
                                     ylabel = indicators.labels[i],
                                     xlabel = 'Week',
                                     target = NULL,
                                     target.unit = NULL,             
                                     UCL.EWMA = UCL.EWMA,                 
                                     LCL.EWMA = LCL.EWMA,             
                                     UCL.SHEW = UCL.SHEW,             
                                     LCL.SHEW = LCL.SHEW,                
                                     alarms.EWMA.UPP = alarms.EWMA.UPP,    
                                     alarms.EWMA.LW = alarms.EWMA.LW,      
                                     alarms.SHEW.UPP = alarms.SHEW.UPP,   
                                     alarms.SHEW.LW = alarms.SHEW.LW,      
                                     series.label="sows")
    }
    
    if (indicators.type[i]=="C") {
      
      plots.gilts[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
                                                 indicator.label = "indicator", 
                                                 show.window = nonTS.to.show,
                                                 index.dates = index.dates.days,
                                                 vertical.line = NULL,              
                                                 vertical.line.label=NULL,
                                                 ylabel = indicators.labels[i],
                                                 xlabel = 'Last 100 events',
                                                 target = NULL,
                                                 target.unit = NULL,             
                                                 UCL.EWMA = UCL.EWMA,              
                                                 LCL.EWMA = LCL.EWMA,               
                                                 UCL.SHEW = UCL.SHEW,            
                                                 LCL.SHEW = LCL.SHEW,              
                                                 alarms.EWMA.UPP = alarms.EWMA.UPP, 
                                                 alarms.EWMA.LW = alarms.EWMA.LW,   
                                                 alarms.SHEW.UPP = alarms.SHEW.UPP, 
                                                 alarms.SHEW.LW = alarms.SHEW.LW, 
                                                 series.label = "sows")
    }
  }
  
  # if (isFALSE(indicators.sys[i])) {
  #   
  #   if (indicators.type[i]=="W") {
  #     
  #     plots.gilts[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
  #                                    indicator.label = "indicator",
  #                                    show.window = weeks.to.show,
  #                                    index.dates = index.dates.week,
  #                                    ylabel = indicators.labels[i],
  #                                    xlabel = 'Week',
  #                                    target = NULL,
  #                                    target.unit = NULL,             
  #                                    UCL.EWMA = FALSE,                 
  #                                    LCL.EWMA = FALSE,             
  #                                    UCL.SHEW = FALSE,             
  #                                    LCL.SHEW = FALSE,                
  #                                    alarms.EWMA.UPP = FALSE,    
  #                                    alarms.EWMA.LW = FALSE,      
  #                                    alarms.SHEW.UPP = FALSE,   
  #                                    alarms.SHEW.LW = FALSE,      
  #                                    series.label="sows")
  #     
  #   }
  #   
  #   if (indicators.type[i]=="C") {
  #     
  #     plots.gilts[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
  #                                                indicator.label = "indicator", 
  #                                                show.window = nonTS.to.show,
  #                                                index.dates = index.dates.days,
  #                                                vertical.line = NULL,              
  #                                                vertical.line.label=NULL,
  #                                                ylabel = indicators.labels[i],
  #                                                xlabel = 'Last 100 events',
  #                                                target = NULL,
  #                                                target.unit = NULL,             
  #                                                UCL.EWMA = FALSE,              
  #                                                LCL.EWMA = FALSE,               
  #                                                UCL.SHEW = FALSE,            
  #                                                LCL.SHEW = FALSE,              
  #                                                alarms.EWMA.UPP = FALSE, 
  #                                                alarms.EWMA.LW = FALSE,   
  #                                                alarms.SHEW.UPP = FALSE, 
  #                                                alarms.SHEW.LW = FALSE, 
  #                                                series.label = "sows")
  #   }
  # }
}

#plots.gilts

```


Empty Sows
====================================

```{r}

plots.empty.sows <- list()

for (i in which(indicators.categories=="empty sows")) {
  #i=which(indicators.categories=="empty sows")[1]

  if (isTRUE(indicators.sys[i])) {
    
    if (indicators.limits[i]=="limit.upp") {
      UCL.EWMA = TRUE
      LCL.EWMA = FALSE
      UCL.SHEW = TRUE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = FALSE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = FALSE
      
    }
    if (indicators.limits[i]=="both") {
      
      UCL.EWMA = TRUE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = TRUE
      
    }
    
    if (indicators.limits[i]=="limit.lw") {
      
      UCL.EWMA = FALSE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = TRUE
      alarms.EWMA.UPP = FALSE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = FALSE
      alarms.SHEW.LW = TRUE
      
    }
    
    if (indicators.type[i]=="W") {
      
      plots.empty.sows[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
                                          indicator.label = "indicator",
                                          show.window = weeks.to.show,
                                          index.dates = index.dates.week,
                                          ylabel = indicators.labels[i],
                                          xlabel = 'Week',
                                          target = NULL,
                                          target.unit = NULL,             
                                          UCL.EWMA = UCL.EWMA,                 
                                          LCL.EWMA = LCL.EWMA,             
                                          UCL.SHEW = UCL.SHEW,             
                                          LCL.SHEW = LCL.SHEW,                
                                          alarms.EWMA.UPP = alarms.EWMA.UPP,    
                                          alarms.EWMA.LW = alarms.EWMA.LW,      
                                          alarms.SHEW.UPP = alarms.SHEW.UPP,   
                                          alarms.SHEW.LW = alarms.SHEW.LW,      
                                          series.label="sows")
    }
    
    if (indicators.type[i]=="C") {
      
      plots.empty.sows[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
                                                      indicator.label = "indicator", 
                                                      show.window = nonTS.to.show,
                                                      index.dates = index.dates.days,
                                                      vertical.line = NULL,              
                                                      vertical.line.label=NULL,
                                                      ylabel = indicators.labels[i],
                                                      xlabel = 'Last 100 events',
                                                      target = NULL,
                                                      target.unit = NULL,             
                                                      UCL.EWMA = UCL.EWMA,              
                                                      LCL.EWMA = LCL.EWMA,               
                                                      UCL.SHEW = UCL.SHEW,            
                                                      LCL.SHEW = LCL.SHEW,              
                                                      alarms.EWMA.UPP = alarms.EWMA.UPP, 
                                                      alarms.EWMA.LW = alarms.EWMA.LW,   
                                                      alarms.SHEW.UPP = alarms.SHEW.UPP, 
                                                      alarms.SHEW.LW = alarms.SHEW.LW, 
                                                      series.label = "sows")
    }
  }
  
  # if (isFALSE(indicators.sys[i])) {
  #   
  #   if (indicators.type[i]=="W") {
  #     
  #     plots.empty.sows[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
  #                                         indicator.label = "indicator",
  #                                         show.window = weeks.to.show,
  #                                         index.dates = index.dates.week,
  #                                         ylabel = indicators.labels[i],
  #                                         xlabel = 'Week',
  #                                         target = NULL,
  #                                         target.unit = NULL,             
  #                                         UCL.EWMA = FALSE,                 
  #                                         LCL.EWMA = FALSE,             
  #                                         UCL.SHEW = FALSE,             
  #                                         LCL.SHEW = FALSE,                
  #                                         alarms.EWMA.UPP = FALSE,    
  #                                         alarms.EWMA.LW = FALSE,      
  #                                         alarms.SHEW.UPP = FALSE,   
  #                                         alarms.SHEW.LW = FALSE,      
  #                                         series.label="sows")
  #     
  #   }
  #   
  #   if (indicators.type[i]=="C") {
  #     
  #     plots.empty.sows[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
  #                                                     indicator.label = "indicator", 
  #                                                     show.window = nonTS.to.show,
  #                                                     index.dates = index.dates.days,
  #                                                     vertical.line = NULL,              
  #                                                     vertical.line.label=NULL,
  #                                                     ylabel = indicators.labels[i],
  #                                                     xlabel = 'Last 100 events',
  #                                                     target = NULL,
  #                                                     target.unit = NULL,             
  #                                                     UCL.EWMA = FALSE,              
  #                                                     LCL.EWMA = FALSE,               
  #                                                     UCL.SHEW = FALSE,            
  #                                                     LCL.SHEW = FALSE,              
  #                                                     alarms.EWMA.UPP = FALSE, 
  #                                                     alarms.EWMA.LW = FALSE,   
  #                                                     alarms.SHEW.UPP = FALSE, 
  #                                                     alarms.SHEW.LW = FALSE, 
  #                                                     series.label = "sows")
  #   }
  # }
}

```

### Sows empty longer than target, weekly

```{r}
plots.empty.sows[[2]]
```


Services
====================================

```{r}

plots.services <- list()

  for (i in which(indicators.categories=="services")) {
    #i=which(indicators.categories=="services")[1]

    if (isTRUE(indicators.sys[i])) {
      
      if (indicators.limits[i]=="limit.upp") {
        
        UCL.EWMA = TRUE
        LCL.EWMA = FALSE
        UCL.SHEW = TRUE
        LCL.SHEW = FALSE
        alarms.EWMA.UPP = TRUE
        alarms.EWMA.LW = FALSE
        alarms.SHEW.UPP = TRUE
        alarms.SHEW.LW = FALSE
        
      }
      if (indicators.limits[i]=="both") {
        
        UCL.EWMA = TRUE
        LCL.EWMA = TRUE
        UCL.SHEW = FALSE
        LCL.SHEW = FALSE
        alarms.EWMA.UPP = TRUE
        alarms.EWMA.LW = TRUE
        alarms.SHEW.UPP = TRUE
        alarms.SHEW.LW = TRUE
        
      }
      
      if (indicators.limits[i]=="limit.lw") {
        
        UCL.EWMA = FALSE
        LCL.EWMA = TRUE
        UCL.SHEW = FALSE
        LCL.SHEW = TRUE
        alarms.EWMA.UPP = FALSE
        alarms.EWMA.LW = TRUE
        alarms.SHEW.UPP = FALSE
        alarms.SHEW.LW = TRUE
        
      }
      
      if (indicators.type[i]=="W") {
        
        plots.services[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
                                          indicator.label = "indicator",
                                          show.window = weeks.to.show,
                                          index.dates = index.dates.week,
                                          ylabel = indicators.labels[i],
                                          xlabel = 'Week',
                                          target = NULL,
                                          target.unit = NULL,             
                                          UCL.EWMA = UCL.EWMA,                 
                                          LCL.EWMA = LCL.EWMA,             
                                          UCL.SHEW = UCL.SHEW,             
                                          LCL.SHEW = LCL.SHEW,                
                                          alarms.EWMA.UPP = alarms.EWMA.UPP,    
                                          alarms.EWMA.LW = alarms.EWMA.LW,      
                                          alarms.SHEW.UPP = alarms.SHEW.UPP,   
                                          alarms.SHEW.LW = alarms.SHEW.LW,      
                                          series.label="sows")
      }
      
      if (indicators.type[i]=="C") {
        
        plots.services[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
                                                      indicator.label = "indicator", 
                                                      show.window = nonTS.to.show,
                                                      index.dates = index.dates.days,
                                                      vertical.line = NULL,              
                                                      vertical.line.label=NULL,
                                                      ylabel = indicators.labels[i],
                                                      xlabel = 'Last 100 events',
                                                      target = NULL,
                                                      target.unit = NULL,             
                                                      UCL.EWMA = UCL.EWMA,              
                                                      LCL.EWMA = LCL.EWMA,               
                                                      UCL.SHEW = UCL.SHEW,            
                                                      LCL.SHEW = LCL.SHEW,              
                                                      alarms.EWMA.UPP = alarms.EWMA.UPP, 
                                                      alarms.EWMA.LW = alarms.EWMA.LW,   
                                                      alarms.SHEW.UPP = alarms.SHEW.UPP, 
                                                      alarms.SHEW.LW = alarms.SHEW.LW, 
                                                      series.label = "sows")
      }
    }
    
    # if (isFALSE(indicators.sys[i])) {
    #   
    #   if (indicators.type[i]=="W") {
    #     
    #     plots.services[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
    #                                       indicator.label = "indicator",
    #                                       show.window = weeks.to.show,
    #                                       index.dates = index.dates.week,
    #                                       ylabel = indicators.labels[i],
    #                                       xlabel = 'Week',
    #                                       target = NULL,
    #                                       target.unit = NULL,             
    #                                       UCL.EWMA = FALSE,                 
    #                                       LCL.EWMA = FALSE,             
    #                                       UCL.SHEW = FALSE,             
    #                                       LCL.SHEW = FALSE,                
    #                                       alarms.EWMA.UPP = FALSE,    
    #                                       alarms.EWMA.LW = FALSE,      
    #                                       alarms.SHEW.UPP = FALSE,   
    #                                       alarms.SHEW.LW = FALSE,      
    #                                       series.label="sows")
    #     
    #   }
    #   
    #   if (indicators.type[i]=="C") {
    #     
    #     plots.services[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
    #                                                   indicator.label = "indicator", 
    #                                                   show.window = nonTS.to.show,
    #                                                   index.dates = index.dates.days,
    #                                                   vertical.line = NULL,              
    #                                                   vertical.line.label=NULL,
    #                                                   ylabel = indicators.labels[i],
    #                                                   xlabel = 'Last 100 events',
    #                                                   target = NULL,
    #                                                   target.unit = NULL,             
    #                                                   UCL.EWMA = FALSE,              
    #                                                   LCL.EWMA = FALSE,               
    #                                                   UCL.SHEW = FALSE,            
    #                                                   LCL.SHEW = FALSE,              
    #                                                   alarms.EWMA.UPP = FALSE, 
    #                                                   alarms.EWMA.LW = FALSE,   
    #                                                   alarms.SHEW.UPP = FALSE, 
    #                                                   alarms.SHEW.LW = FALSE, 
    #                                                   series.label = "sows")
    #   }
    # }
  }

```

Row
-------------------------------------

### Reservices per week
```{r}
plots.services[[3]]

```

Row
-------------------------------------

### Time to reservice
```{r}
plots.services[[4]]

```

Row
-------------------------------------

### % failure, weekly
```{r}
plots.services[[5]]

```

Row
-------------------------------------

### % reservice, weekly
```{r}
plots.services[[6]]

```


Pregnancy
====================================

```{r}

plots.pregnancy <- list()

  for (i in which(indicators.categories=="pregnancy")) {
    #i=which(indicators.categories=="pregnancy")[1]
    
    if (isTRUE(indicators.sys[i])) {
      
      if (indicators.limits[i]=="limit.upp") {
        
        UCL.EWMA = TRUE
        LCL.EWMA = FALSE
        UCL.SHEW = TRUE
        LCL.SHEW = FALSE
        alarms.EWMA.UPP = TRUE
        alarms.EWMA.LW = FALSE
        alarms.SHEW.UPP = TRUE
        alarms.SHEW.LW = FALSE
        
      }
      
      if (indicators.limits[i]=="both") {
        
        UCL.EWMA = TRUE
        LCL.EWMA = TRUE
        UCL.SHEW = FALSE
        LCL.SHEW = FALSE
        alarms.EWMA.UPP = TRUE
        alarms.EWMA.LW = TRUE
        alarms.SHEW.UPP = TRUE
        alarms.SHEW.LW = TRUE
        
      }
      
      if (indicators.limits[i]=="limit.lw") {
        
        UCL.EWMA = FALSE
        LCL.EWMA = TRUE
        UCL.SHEW = FALSE
        LCL.SHEW = TRUE
        alarms.EWMA.UPP = FALSE
        alarms.EWMA.LW = TRUE
        alarms.SHEW.UPP = FALSE
        alarms.SHEW.LW = TRUE
        
      }
      
      if (indicators.type[i]=="W") {
        
        plots.pregnancy[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
                                           indicator.label = "indicator",
                                           show.window = weeks.to.show,
                                           index.dates = index.dates.week,
                                           ylabel = indicators.labels[i],
                                           xlabel = 'Week',
                                           target = NULL,
                                           target.unit = NULL,             
                                           UCL.EWMA = UCL.EWMA,                 
                                           LCL.EWMA = LCL.EWMA,             
                                           UCL.SHEW = UCL.SHEW,             
                                           LCL.SHEW = LCL.SHEW,                
                                           alarms.EWMA.UPP = alarms.EWMA.UPP,    
                                           alarms.EWMA.LW = alarms.EWMA.LW,      
                                           alarms.SHEW.UPP = alarms.SHEW.UPP,   
                                           alarms.SHEW.LW = alarms.SHEW.LW,      
                                           series.label="sows")
      }
      
      if (indicators.type[i]=="C") {
        
        plots.pregnancy[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
                                                       indicator.label = "indicator", 
                                                       show.window = nonTS.to.show,
                                                       index.dates = index.dates.days,
                                                       vertical.line = NULL,              
                                                       vertical.line.label=NULL,
                                                       ylabel = indicators.labels[i],
                                                       xlabel = 'Last 100 events',
                                                       target = NULL,
                                                       target.unit = NULL,             
                                                       UCL.EWMA = UCL.EWMA,              
                                                       LCL.EWMA = LCL.EWMA,               
                                                       UCL.SHEW = UCL.SHEW,            
                                                       LCL.SHEW = LCL.SHEW,              
                                                       alarms.EWMA.UPP = alarms.EWMA.UPP, 
                                                       alarms.EWMA.LW = alarms.EWMA.LW,   
                                                       alarms.SHEW.UPP = alarms.SHEW.UPP, 
                                                       alarms.SHEW.LW = alarms.SHEW.LW, 
                                                       series.label = "sows")
      }
    }
    
    # if (isFALSE(indicators.sys[i])) {
    #   
    #   if (indicators.type[i]=="W") {
    #     
    #     plots.pregnancy[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
    #                                        indicator.label = "indicator",
    #                                        show.window = weeks.to.show,
    #                                        index.dates = index.dates.week,
    #                                        ylabel = indicators.labels[i],
    #                                        xlabel = 'Week',
    #                                        target = NULL,
    #                                        target.unit = NULL,             
    #                                        UCL.EWMA = FALSE,                 
    #                                        LCL.EWMA = FALSE,             
    #                                        UCL.SHEW = FALSE,             
    #                                        LCL.SHEW = FALSE,                
    #                                        alarms.EWMA.UPP = FALSE,    
    #                                        alarms.EWMA.LW = FALSE,      
    #                                        alarms.SHEW.UPP = FALSE,   
    #                                        alarms.SHEW.LW = FALSE,      
    #                                        series.label="sows")
    #     
    #   }
    #   
    #   if (indicators.type[i]=="C") {
    #     
    #     plots.pregnancy[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
    #                                                    indicator.label = "indicator", 
    #                                                    show.window = nonTS.to.show,
    #                                                    index.dates = index.dates.days,
    #                                                    vertical.line = NULL,              
    #                                                    vertical.line.label=NULL,
    #                                                    ylabel = indicators.labels[i],
    #                                                    xlabel = 'Last 100 events',
    #                                                    target = NULL,
    #                                                    target.unit = NULL,             
    #                                                    UCL.EWMA = FALSE,              
    #                                                    LCL.EWMA = FALSE,               
    #                                                    UCL.SHEW = FALSE,            
    #                                                    LCL.SHEW = FALSE,              
    #                                                    alarms.EWMA.UPP = FALSE, 
    #                                                    alarms.EWMA.LW = FALSE,   
    #                                                    alarms.SHEW.UPP = FALSE, 
    #                                                    alarms.SHEW.LW = FALSE, 
    #                                                    series.label = "sows")
    #   }
    # }
  }


```

Row
-------------------------------------

### Abortions per week
```{r}
plots.pregnancy[[9]]

```

Row
-------------------------------------

### Pregnancy length
```{r}
plots.pregnancy[[11]]

```

Farrowing
====================================

```{r}

plots.farrowing <- list()

  for (i in which(indicators.categories=="farrowing")) {
    #i=which(indicators.categories=="farrowing")
    
    if (isTRUE(indicators.sys[i])) {
      
      if (indicators.limits[i]=="limit.upp") {
        
        UCL.EWMA = TRUE
        LCL.EWMA = FALSE
        UCL.SHEW = TRUE
        LCL.SHEW = FALSE
        alarms.EWMA.UPP = TRUE
        alarms.EWMA.LW = FALSE
        alarms.SHEW.UPP = TRUE
        alarms.SHEW.LW = FALSE
        
      }
      if (indicators.limits[i]=="both") {
        
        UCL.EWMA = TRUE
        LCL.EWMA = TRUE
        UCL.SHEW = FALSE
        LCL.SHEW = FALSE
        alarms.EWMA.UPP = TRUE
        alarms.EWMA.LW = TRUE
        alarms.SHEW.UPP = TRUE
        alarms.SHEW.LW = TRUE
        
      }
      
      if (indicators.limits[i]=="limit.lw") {
        
        UCL.EWMA = FALSE
        LCL.EWMA = TRUE
        UCL.SHEW = FALSE
        LCL.SHEW = TRUE
        alarms.EWMA.UPP = FALSE
        alarms.EWMA.LW = TRUE
        alarms.SHEW.UPP = FALSE
        alarms.SHEW.LW = TRUE
        
      }
      
      if (indicators.type[i]=="W") {
        
        plots.farrowing[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
                                           indicator.label = "indicator",
                                           show.window = weeks.to.show,
                                           index.dates = index.dates.week,
                                           ylabel = indicators.labels[i],
                                           xlabel = 'Week',
                                           target = NULL,
                                           target.unit = NULL,             
                                           UCL.EWMA = UCL.EWMA,                 
                                           LCL.EWMA = LCL.EWMA,             
                                           UCL.SHEW = UCL.SHEW,             
                                           LCL.SHEW = LCL.SHEW,                
                                           alarms.EWMA.UPP = alarms.EWMA.UPP,    
                                           alarms.EWMA.LW = alarms.EWMA.LW,      
                                           alarms.SHEW.UPP = alarms.SHEW.UPP,   
                                           alarms.SHEW.LW = alarms.SHEW.LW,      
                                           series.label="piglets")
      }
      
      if (indicators.type[i]=="C") {
        
        plots.farrowing[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
                                                       indicator.label = "indicator", 
                                                       show.window = nonTS.to.show,
                                                       index.dates = index.dates.days,
                                                       vertical.line = NULL,              
                                                       vertical.line.label=NULL,
                                                       ylabel = indicators.labels[i],
                                                       xlabel = 'Last 100 events',
                                                       target = NULL,
                                                       target.unit = NULL,             
                                                       UCL.EWMA = UCL.EWMA,              
                                                       LCL.EWMA = LCL.EWMA,               
                                                       UCL.SHEW = UCL.SHEW,            
                                                       LCL.SHEW = LCL.SHEW,              
                                                       alarms.EWMA.UPP = alarms.EWMA.UPP, 
                                                       alarms.EWMA.LW = alarms.EWMA.LW,   
                                                       alarms.SHEW.UPP = alarms.SHEW.UPP, 
                                                       alarms.SHEW.LW = alarms.SHEW.LW, 
                                                       series.label = "piglets")
      }
    }
    
    # if (isFALSE(indicators.sys[i])) {
    #   
    #   if (indicators.type[i]=="W") {
    #     
    #     plots.farrowing[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
    #                                        indicator.label = "indicator",
    #                                        show.window = weeks.to.show,
    #                                        index.dates = index.dates.week,
    #                                        ylabel = indicators.labels[i],
    #                                        xlabel = 'Week',
    #                                        target = NULL,
    #                                        target.unit = NULL,             
    #                                        UCL.EWMA = FALSE,                 
    #                                        LCL.EWMA = FALSE,             
    #                                        UCL.SHEW = FALSE,             
    #                                        LCL.SHEW = FALSE,                
    #                                        alarms.EWMA.UPP = FALSE,    
    #                                        alarms.EWMA.LW = FALSE,      
    #                                        alarms.SHEW.UPP = FALSE,   
    #                                        alarms.SHEW.LW = FALSE,      
    #                                        series.label= NULL)
    #     
    #   }
    #   
    #   if (indicators.type[i]=="C") {
    #     
    #     plots.farrowing[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
    #                                                    indicator.label = "indicator", 
    #                                                    show.window = nonTS.to.show,
    #                                                    index.dates = index.dates.days,
    #                                                    vertical.line = NULL,              
    #                                                    vertical.line.label=NULL,
    #                                                    ylabel = indicators.labels[i],
    #                                                    xlabel = 'Last 100 events',
    #                                                    target = NULL,
    #                                                    target.unit = NULL,             
    #                                                    UCL.EWMA = FALSE,              
    #                                                    LCL.EWMA = FALSE,               
    #                                                    UCL.SHEW = FALSE,            
    #                                                    LCL.SHEW = FALSE,              
    #                                                    alarms.EWMA.UPP = FALSE, 
    #                                                    alarms.EWMA.LW = FALSE,   
    #                                                    alarms.SHEW.UPP = FALSE, 
    #                                                    alarms.SHEW.LW = FALSE, 
    #                                                    series.label = NULL)
    #   }
    # }
  }


```

Row
-------------------------------------

### Days between farrowings

```{r}
plots.farrowing[[12]]
```

Row
-------------------------------------

### farrowings per week

```{r}
plots.farrowing[[13]]
```

Row
-------------------------------------

### piglets per farrowing

```{r}
plots.farrowing[[14]]
```

Row
-------------------------------------

### live born per farrowing

```{r}
plots.farrowing[[15]]
```

Row
-------------------------------------

### dead born per farrowing

```{r}
plots.farrowing[[16]]
```

Row
-------------------------------------

### % dead born per farrowing

```{r}
plots.farrowing[[17]]
```

Row
-------------------------------------

### mummified per farrowing

```{r}
plots.farrowing[[18]]
```


Weaning
====================================

```{r}

plots.weaning <- list()

  for (i in which(indicators.categories=="weaning")) {
  #i=which(indicators.categories=="weaning")[3]
  
  if (isTRUE(indicators.sys[i])) {
    
    if (indicators.limits[i]=="limit.upp") {
      
      UCL.EWMA = TRUE
      LCL.EWMA = FALSE
      UCL.SHEW = TRUE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = FALSE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = FALSE
      
    }
    
    if (indicators.limits[i]=="both") {
      
      UCL.EWMA = TRUE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = TRUE
      
    }
    
    if (indicators.limits[i]=="limit.lw") {
      
      UCL.EWMA = FALSE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = TRUE
      alarms.EWMA.UPP = FALSE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = FALSE
      alarms.SHEW.LW = TRUE
      
    }
    
    if (indicators.type[i]=="W") {
      
      plots.weaning[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
                                       indicator.label = "indicator",
                                       show.window = weeks.to.show,
                                       index.dates = index.dates.week,
                                       ylabel = indicators.labels[i],
                                       xlabel = 'Week',
                                       target = NULL,
                                       target.unit = NULL,             
                                       UCL.EWMA = UCL.EWMA,                 
                                       LCL.EWMA = LCL.EWMA,             
                                       UCL.SHEW = UCL.SHEW,             
                                       LCL.SHEW = LCL.SHEW,                
                                       alarms.EWMA.UPP = alarms.EWMA.UPP,    
                                       alarms.EWMA.LW = alarms.EWMA.LW,      
                                       alarms.SHEW.UPP = alarms.SHEW.UPP,   
                                       alarms.SHEW.LW = alarms.SHEW.LW,      
                                       series.label="piglets")
    }
    
    if (indicators.type[i]=="C") {
      
      plots.weaning[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
                                                   indicator.label = "indicator", 
                                                   show.window = nonTS.to.show,
                                                   index.dates = index.dates.days,
                                                   vertical.line = NULL,              
                                                   vertical.line.label=NULL,
                                                   ylabel = indicators.labels[i],
                                                   xlabel = 'Last 100 events',
                                                   target = NULL,
                                                   target.unit = NULL,             
                                                   UCL.EWMA = UCL.EWMA,              
                                                   LCL.EWMA = LCL.EWMA,               
                                                   UCL.SHEW = UCL.SHEW,            
                                                   LCL.SHEW = LCL.SHEW,              
                                                   alarms.EWMA.UPP = alarms.EWMA.UPP, 
                                                   alarms.EWMA.LW = alarms.EWMA.LW,   
                                                   alarms.SHEW.UPP = alarms.SHEW.UPP, 
                                                   alarms.SHEW.LW = alarms.SHEW.LW, 
                                                   series.label = "piglets")
    }
  }
  
  # if (isFALSE(indicators.sys[i])) {
  #   
  #   if (indicators.type[i]=="W") {
  #     
  #     plots.weaning[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
  #                                      indicator.label = "indicator",
  #                                      show.window = weeks.to.show,
  #                                      index.dates = index.dates.week,
  #                                      ylabel = indicators.labels[i],
  #                                      xlabel = 'Week',
  #                                      target = NULL,
  #                                      target.unit = NULL,             
  #                                      UCL.EWMA = FALSE,                 
  #                                      LCL.EWMA = FALSE,             
  #                                      UCL.SHEW = FALSE,             
  #                                      LCL.SHEW = FALSE,                
  #                                      alarms.EWMA.UPP = FALSE,    
  #                                      alarms.EWMA.LW = FALSE,      
  #                                      alarms.SHEW.UPP = FALSE,   
  #                                      alarms.SHEW.LW = FALSE,      
  #                                      series.label=NULL)
  #     
  #   }
  #   
  #   if (indicators.type[i]=="C") {
  #     
  #     plots.weaning[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
  #                                                  indicator.label = "indicator", 
  #                                                  show.window = nonTS.to.show,
  #                                                  index.dates = index.dates.days,
  #                                                  vertical.line = NULL,              
  #                                                  vertical.line.label=NULL,
  #                                                  ylabel = indicators.labels[i],
  #                                                  xlabel = 'Last 100 events',
  #                                                  target = NULL,
  #                                                  target.unit = NULL,             
  #                                                  UCL.EWMA = FALSE,              
  #                                                  LCL.EWMA = FALSE,               
  #                                                  UCL.SHEW = FALSE,            
  #                                                  LCL.SHEW = FALSE,              
  #                                                  alarms.EWMA.UPP = FALSE, 
  #                                                  alarms.EWMA.LW = FALSE,   
  #                                                  alarms.SHEW.UPP = FALSE, 
  #                                                  alarms.SHEW.LW = FALSE, 
  #                                                  series.label = NULL)
  #   }
  # }
}

plots.weaning
```


Post-Weaning
====================================

```{r}

plots.post.weaning <- list()

   
for (i in which(indicators.categories=="post-weaning")) {
  #i=which(indicators.categories=="post-weaning")[1]
  
  if (isTRUE(indicators.sys[i])) {
    
    if (indicators.limits[i]=="limit.upp") {
      
      UCL.EWMA = TRUE
      LCL.EWMA = FALSE
      UCL.SHEW = TRUE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = FALSE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = FALSE
      
    }
    if (indicators.limits[i]=="both") {
      
      UCL.EWMA = TRUE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = TRUE
      
    }
    
    if (indicators.limits[i]=="limit.lw") {
      
      UCL.EWMA = FALSE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = TRUE
      alarms.EWMA.UPP = FALSE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = FALSE
      alarms.SHEW.LW = TRUE
      
    }
    
    if (indicators.type[i]=="W") {
      
      plots.post.weaning[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
                                            indicator.label = "indicator",
                                            show.window = weeks.to.show,
                                            index.dates = index.dates.week,
                                            ylabel = indicators.labels[i],
                                            xlabel = 'Week',
                                            target = NULL,
                                            target.unit = NULL,             
                                            UCL.EWMA = UCL.EWMA,                 
                                            LCL.EWMA = LCL.EWMA,             
                                            UCL.SHEW = UCL.SHEW,             
                                            LCL.SHEW = LCL.SHEW,                
                                            alarms.EWMA.UPP = alarms.EWMA.UPP,    
                                            alarms.EWMA.LW = alarms.EWMA.LW,      
                                            alarms.SHEW.UPP = alarms.SHEW.UPP,   
                                            alarms.SHEW.LW = alarms.SHEW.LW,      
                                            series.label="weaned piglets")
    }
    
    if (indicators.type[i]=="C") {
      
      plots.post.weaning[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
                                                        indicator.label = "indicator", 
                                                        show.window = nonTS.to.show,
                                                        index.dates = index.dates.days,
                                                        vertical.line = NULL,              
                                                        vertical.line.label=NULL,
                                                        ylabel = indicators.labels[i],
                                                        xlabel = 'Last 100 events',
                                                        target = NULL,
                                                        target.unit = NULL,             
                                                        UCL.EWMA = UCL.EWMA,              
                                                        LCL.EWMA = LCL.EWMA,               
                                                        UCL.SHEW = UCL.SHEW,            
                                                        LCL.SHEW = LCL.SHEW,              
                                                        alarms.EWMA.UPP = alarms.EWMA.UPP, 
                                                        alarms.EWMA.LW = alarms.EWMA.LW,   
                                                        alarms.SHEW.UPP = alarms.SHEW.UPP, 
                                                        alarms.SHEW.LW = alarms.SHEW.LW, 
                                                        series.label = "weaned piglets")
    }
  }
  
  # if (isFALSE(indicators.sys[i])) {
  #   
  #   if (indicators.type[i]=="W") {
  #     
  #     plots.post.weaning[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
  #                                           indicator.label = "indicator",
  #                                           show.window = weeks.to.show,
  #                                           index.dates = index.dates.week,
  #                                           ylabel = indicators.labels[i],
  #                                           xlabel = 'Week',
  #                                           target = NULL,
  #                                           target.unit = NULL,             
  #                                           UCL.EWMA = FALSE,                 
  #                                           LCL.EWMA = FALSE,             
  #                                           UCL.SHEW = FALSE,             
  #                                           LCL.SHEW = FALSE,                
  #                                           alarms.EWMA.UPP = FALSE,    
  #                                           alarms.EWMA.LW = FALSE,      
  #                                           alarms.SHEW.UPP = FALSE,   
  #                                           alarms.SHEW.LW = FALSE,      
  #                                           series.label=NULL)
  #     
  #   }
  #   
  #   if (indicators.type[i]=="C") {
  #     
  #     plots.post.weaning[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
  #                                                       indicator.label = "indicator", 
  #                                                       show.window = nonTS.to.show,
  #                                                       index.dates = index.dates.days,
  #                                                       vertical.line = NULL,              
  #                                                       vertical.line.label=NULL,
  #                                                       ylabel = indicators.labels[i],
  #                                                       xlabel = 'Last 100 events',
  #                                                       target = NULL,
  #                                                       target.unit = NULL,             
  #                                                       UCL.EWMA = FALSE,              
  #                                                       LCL.EWMA = FALSE,               
  #                                                       UCL.SHEW = FALSE,            
  #                                                       LCL.SHEW = FALSE,              
  #                                                       alarms.EWMA.UPP = FALSE, 
  #                                                       alarms.EWMA.LW = FALSE,   
  #                                                       alarms.SHEW.UPP = FALSE, 
  #                                                       alarms.SHEW.LW = FALSE, 
  #                                                       series.label = NULL)
  #   }
  # }
}

plots.post.weaning

```


Exit
====================================

```{r}

plots.exit <- list()

  for (i in which(indicators.categories=="exit")) {
  #i=which(indicators.categories=="exit")[1]

  if (isTRUE(indicators.sys[i])) {

    if (indicators.limits[i]=="limit.upp") {

      UCL.EWMA = TRUE
      LCL.EWMA = FALSE
      UCL.SHEW = TRUE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = FALSE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = FALSE

    }
    if (indicators.limits[i]=="both") {

      UCL.EWMA = TRUE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = FALSE
      alarms.EWMA.UPP = TRUE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = TRUE
      alarms.SHEW.LW = TRUE

    }

    if (indicators.limits[i]=="limit.lw") {

      UCL.EWMA = FALSE
      LCL.EWMA = TRUE
      UCL.SHEW = FALSE
      LCL.SHEW = TRUE
      alarms.EWMA.UPP = FALSE
      alarms.EWMA.LW = TRUE
      alarms.SHEW.UPP = FALSE
      alarms.SHEW.LW = TRUE

    }

    if (indicators.type[i]=="W") {

      plots.exit[[i]] <- TS.barplot(df.indicator = indicators.time.series[[i]],
                                    indicator.label = "indicator",
                                    show.window = weeks.to.show,
                                    index.dates = index.dates.week,
                                    ylabel = indicators.labels[i],
                                    xlabel = 'Week',
                                    target = NULL,
                                    target.unit = NULL,
                                    UCL.EWMA = UCL.EWMA,
                                    LCL.EWMA = LCL.EWMA,
                                    UCL.SHEW = UCL.SHEW,
                                    LCL.SHEW = LCL.SHEW,
                                    alarms.EWMA.UPP = alarms.EWMA.UPP,
                                    alarms.EWMA.LW = alarms.EWMA.LW,
                                    alarms.SHEW.UPP = alarms.SHEW.UPP,
                                    alarms.SHEW.LW = alarms.SHEW.LW,
                                    series.label="sows")
    }

    if (indicators.type[i]=="C") {

      plots.exit[[i]] <- nonTS.barplot.timeless(df.indicator=indicators.time.series[[i]],
                                                indicator.label = "indicator",
                                                how.window = nonTS.to.show,
                                                index.dates = index.dates.days,
                                                vertical.line = NULL,
                                                vertical.line.label=NULL,
                                                ylabel = indicators.labels[i],
                                                xlabel = 'Last 100 events',
                                                target = NULL,
                                                target.unit = NULL,
                                                UCL.EWMA = UCL.EWMA,
                                                LCL.EWMA = LCL.EWMA,
                                                UCL.SHEW = UCL.SHEW,
                                                LCL.SHEW = LCL.SHEW,
                                                alarms.EWMA.UPP = alarms.EWMA.UPP,
                                                alarms.EWMA.LW = alarms.EWMA.LW,
                                                alarms.SHEW.UPP = alarms.SHEW.UPP,
                                                alarms.SHEW.LW = alarms.SHEW.LW,
                                                series.label = "sows")
    }
  }

  if (isFALSE(indicators.sys[i])) {

    if (indicators.type[i]=="W") {

      if (dim(indicators.time.series[[i]])[2]==6) {

        group.labels=c('birth','service','reservice','abortion','farrowing','weaning')

      }

      if (dim(indicators.time.series[[i]])[2]==7) {

        group.labels=c('slaughtered','sold','euthanized','dead','sold.pregnant','missing','exported')

      }

      plots.exit[[i]] <- TS.exit(#indicator = indicators.data[[ind]],
                                 df.indicator=indicators.time.series[[i]],
                                 indicator.label="Number of sows",
                                 show.window = weeks.to.show,
                                 index.dates = index.dates.week,
                                 ylabel = indicators.labels[i],
                                 xlabel = 'Week',
                                 target = NULL,
                                 target.unit = NULL,
                                 shading.matrix = NULL,
                                 limits = NULL,
                                 group.labels=group.labels

      )
    }
  }
  }


```

Row
-------------------------------------

### sow deaths per week

```{r}
plots.exit[[25]]
```

Row
-------------------------------------

### gilt deaths per week

```{r}
plots.exit[[26]]
```

Row
-------------------------------------

### death after event, weekly

```{r}
plots.exit[[28]]
```

Row
-------------------------------------

### number of exits per week

```{r}
plots.exit[[29]]
```

Row
-------------------------------------

### exit type, weekly

```{r}
plots.exit[[30]]
```

Row
-------------------------------------

### exit after event, weekly

```{r}
plots.exit[[31]]
```

